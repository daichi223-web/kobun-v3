# 開発ログ: 古文読み v3 初期実装
> 日付: 2026-02-12

## 作業サマリー
v2（ゲーム型ドリルアプリ）をv3（テキスト中心の読解アプリ）に全面再設計・実装。
ブレスト合意に基づく螺旋モデルの基盤を構築し、パイロット2テキストとコア画面を完成。

## 判断ログ

### 1. v2からの流用範囲
- **選択肢**: (A) v2をリファクタ (B) v2をコピーしてゲーム削除+新規追加
- **選択**: (B) コピー→削除→追加
- **理由**: ゲームコンポーネント7つ・ゲームデータ全てが不要。layout/globals.css/config系のみ流用。
- **却下**: (A) はゲーム残骸の整理に時間がかかる

### 2. Radix UIの採用
- **選択肢**: (A) Radix UI (B) 自前実装 (C) headless-ui
- **選択**: (A) Radix UI（popover, dialog, tabs）
- **理由**: アクセシビリティ保証、Tailwind統合が容易、Next.js対応済み

### 3. ポップオーバーの実装方式
- **選択肢**: (A) Radix Popover直接使用 (B) 自前ポップオーバー＋モバイルボトムシート
- **選択**: (B) sm:以上でabsoluteポップオーバー、sm未満でfixed bottom sheet
- **理由**: Radix PopoverはReact 19/Next 16との互換性テストが必要。CSSメディアクエリで切り替える方が確実。

### 4. テキストデータ構造
- **選択**: Token単位での分割（形態素レベル）
- **理由**: 品詞分解の粒度と一致。文節単位だと助動詞の分析が困難。

### 5. 文法リファレンスの実装
- **選択**: JSON + 簡易Markdownレンダラ
- **理由**: vault のMarkdownデータをそのまま変換可能。完全なMDXは過剰。

## 手戻り記録
- npm install がnode_modulesコピー後削除で11分かかった → PowerShell除外スクリプトに修正
- 手戻り率: 5%以下（軽微）

## ユーザーフィードバック原文
（なし — 初回実装）

## 制約・前提（新たに判明したもの）
- Next.js 16.1.6 + React 19.2.3 でRadix UIが動作することは未検証（ビルドは通る）
- 動的import (`import()`) でJSON読込しているため、ファイル名はビルド時確定が必要

## エージェント利用記録
| エージェント | 用途 | 結果 |
|:--|:--|:--|
| Explore agent | v2ファイル構造調査 | 成功 — 36ファイル一覧取得 |
| Explore agent | vault文法/ブレスト文書調査 | 成功 — 16文法MD確認 |
| General-purpose agent | 絵仏師良秀テキストデータ作成 | 成功 — 13文/273トークン、JSON検証済み |

## 未解決の問題
- [ ] 文法リファレンスJSON: 16トピック中7つのみ作成（残り9つは準備中表示）
- [ ] PWAアイコン（icon-192.png, icon-512.png）未作成
- [ ] Radix UI実行時互換性のテスト（dev serverでの動作確認）
- [ ] テキストデータの品詞分解精度の人間レビュー

## 次回への申し送り
1. `npm run dev` でブラウザ動作確認（特にポップオーバーとlayer切替）
2. 残り9つの文法リファレンスJSON作成（vaultのMDから変換）
3. PWAアイコン作成
4. テキストデータの品詞分解精度を先生にレビュー依頼
